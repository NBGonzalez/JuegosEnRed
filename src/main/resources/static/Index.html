<!doctype html> 
<html lang="en"> 
<head>
    <meta charset="UTF-8" />
    <title>Virtual Velocity: Racing Unleashed</title>
    <audio autoplay id="miMusica" loop>
        <source src="assets/musica.mp3" type="audio/mp3">
    </audio>
    <script src="https://code.jquery.com/jquery-2.2.0.min.js">
	</script>
    <script src="phaser.js"></script>
    <link rel="stylesheet" type="text/css" href="menu.css">
    
</head>
<body>
    <div id="pantallaCarga">
        <h1>Cargando...</h1>
        <div class="barraCarga" id="barraCarga"></div>
    </div>
    
    <div id="mensajeRegExito" style="display: none; color: green;">
    	¡Registro exitoso! Usuario creado con éxito
	</div>
	
	<div id="mensajeRegFallido" style="display: none; color: rgb(255, 0, 0);">
    	¡Registro fallido! Nombre ya en uso
	</div>
	
	<div id="mensajeLogFallido" style="display: none; color: rgb(255, 0, 0);">
    	¡Inicio fallido! Nombre o contraseña incorrectos
	</div>
	
	<div id="mensajeActExito" style="display: none; color: rgb(0, 128, 0);">
    	¡Actualización exitosa! Nombre y contraseña actualizados
	</div>
	
	<div id="mensajeActFallido" style="display: none; color: rgb(255, 0, 0);">
    	¡Actualización fallida! Nombre incorrecto
	</div>
	
	<div id="mensajeEliExito" style="display: none; color: green;">
    	¡Usuario eliminado con éxito!
	</div>
	
	<div id="mensajeEliFallido" style="display: none; color: rgb(255, 0, 0);">
    	¡Eliminación fallida! Nombre o contraseña incorrectos
	</div>
	
	<div id="mensajePelota" style="display: none; color: green;">
    	¡Eso ha sido una jugada de mucha inteligencia! Tal y como haría el profe
	</div>
	
	<div id="mensajeUsuarioEncontrado" style="display:none; color: green;">Usuario encontrado. <span id="idUsuarioEncontrado"></span></div>
	
	<div id="mensajeUsuarioNoEncontrado" style="display:none; color: rgb(255, 0, 0);">Usuario no encontrado. Nombre o contraseña incorrectos</div>
	
	<div id="chat-container">
	 <div id="chat"></div>
    <div id="chat2" style="display: none;">
        <!--<input type="text" id="remitente" placeholder="Tu nombre">-->
        <input type="text" id="contenido" placeholder="Escribe tu mensaje">
        <button onclick="enviarMensaje()">Enviar</button>
    </div>
    </div>

     <div id="inicioSesion" style="display: none;">
        <h2>Iniciar Sesión</h2>
        <label for="usuario">Usuario:</label>
        <input type="text" id="usuario" name="usuario">
        <label for="contrasena">Contraseña:</label>
        <input type="password" id="contrasena" name="contrasena">
        <button onclick="iniciarSesion()">Iniciar</button>
        <button onclick="obtenerId()">ID</button>
        <p>¿No tienes una cuenta? <a href="#" onclick="mostrarRegistro()" class="enlaceRegistrarse">Registrarse</a></p>
        <p>¿Olvidaste la contraseña? <a href="#" onclick="mostrarOlvidar()" class="enlaceOlvidar">Recuperar</a></p>
        <p>¿Eliminar cuenta? <a href="#" onclick="mostrarEliminarCuenta()" class="enlaceEliminar">Eliminar</a></p>
    </div>

    <div id="registro" style="display: none;">
        <h2>Registrarse</h2>
        <label for="nombre">Nombre:</label>
        <input type="text" id="nombre" name="nombre">
        <label for="nuevaContrasena">Contraseña:</label>
        <input type="password" id="nuevaContrasena" name="nuevaContrasena">
        <button onclick="registrar()">Registrar</button>
        <p>¿Ya tienes una cuenta? <a href="#" onclick="mostrarInicioSesion()" class="enlaceIniciarSesion">Iniciar Sesión</a></p>
    </div>
    
    <div id="recuperar" style="display: none;">
        <h2>Actualizar Datos</h2>
        <p><label for="nombre2">Nombre:</label></p>
        <input type="text" id="nombre2" name="nombre2">
        <p><label for="nuevoNombre">Nuevo nombre:</label></p>
        <input type="text" id="nuevoNombre" name="nuevoNombre">
        <p><label for="nuevaContrasena2">Nueva contraseña:</label></p>
        <input type="password" id="nuevaContrasena2" name="nuevaContrasena2">
        <button onclick="actualizarDatos()">Actualizar</button>
        <p>¿Ya tienes una cuenta? <a href="#" onclick="mostrarInicioSesion()" class="enlaceIniciarSesion">Iniciar Sesión</a></p>
    </div>
    
    <div id="eliminar" style="display: none;">
        <h2>Eliminar Cuenta</h2>
        <p><label for="nombre3">Nombre:</label></p>
        <input type="text" id="nombre3" name="nombre3">
        <p><label for="contrasena2">Contraseña:</label></p>
        <input type="password" id="contrasena2" name="contrasena2">
        <button onclick="eliminarCuenta()">Eliminar</button>
        <p>¿Ya tienes una cuenta? <a href="#" onclick="mostrarInicioSesion()" class="enlaceIniciarSesion">Iniciar Sesión</a></p>
    </div>

    <div id="menu">
        <h1>VIRTUAL VELOCITY: RACING UNLEASHED </h1>
        <button onclick="irIniciarSesion()">JUGAR</button>
        <button onclick="verCreditos()">CRÉDITOS</button>
        <button onclick="verAjustes()">AJUSTES</button>
        <button onclick="verControles()">CONTROLES</button>
        <button onclick="salirDelJuego()">SALIR</button>
    </div>

    <div id="creditos" style="display: none;">
        <h2>CRÉDITOS</h2>
        <ul id="listaCreditos">
            <li>NÉSTOR BERMEJILLO GONZÁLEZ</li>
            <li>ANTONIO BERNAL DE CELIS</li>
            <li>ÁNGEL LUIS RODRÍGUEZ OTERO</li>
            <li>ALEJANDRO TOBÍAS MÁRQUEZ</li>
            <li>PABLO PRIOR MOLINA</li>
            <li></li>
            <li>BY</li>
            <img src="assets/PixelPulseLogo.png" alt="Imagen" />
            <button onclick="volverAlMenu()">MENÚ</button>
        </ul>
    </div>
    
    <div id="ajustes" style="display: none;">
        <div class="contenido-ajustes">
            <h2>AJUSTES</h2>
            <button id="sonido" onclick="estadoVolumen()">
                <img id="imagenAltavoz" src="assets/altavoz.png" alt="Altavoz">
            </button>
            <input type="range" id="sliderVolumen" min="0" max="1" step="0.01" value="1.0" oninput="cambiarVolumen()">
            <button onclick="mostrarSelectorVueltas()">VUELTAS</button>
            <button onclick="volverAlMenu()">MENÚ</button>
        </div>
    </div>

    <div id="controles" style="display: none;">
        <h2>CONTROLES</h2>
        
        <div style="display: flex; justify-content: space-between;">
            <div style="flex: 1;">
                <p style="color: rgb(0, 153, 204);">J1</p>
                <p>WASD - MOVIMIENTO</p>
                <p>QER - POWER-UPS</p>
            </div>
            
            <div style="flex: 1;">
                <p style="color: rgb(153, 204, 0);">J2</p>
                <p>IJKL - MOVIMIENTO</p>
                <p>UOP - POWER-UPS</p>
            </div>
        </div>
        
        <button onclick="volverAlMenu()">MENÚ</button>
    </div>

    <div id="pausa" style="display: none;">
        <h2><style></style>¡PAREN MOTORES!</h2>
        <button onclick="reanudarJuego()">REANUDAR</button>
        <button id="sonido" onclick="estadoVolumen()">
            <img id="imagenAltavoz" src="assets/altavoz.png" alt="Altavoz">
        </button>
        <button onclick="volverDesdePausa()">MENÚ</button>
    </div>

    <script src="menu.js" data-vueltas="${vueltasTotales}"></script>

	<script>
    function cargarMensajes() {
    //console.log('mensaje cargado');
    $.ajax({
        method: "GET",
        url: "/mensajes",
        dataType: "json",
        success: function (mensajes) {
            $("#chat").empty();
            mensajes.forEach(function (mensaje) {
                var mensajeHTML = "<p><strong style='color: red;'>" + mensaje.remitente + ":</strong> <span style='color: white;'>" + mensaje.contenido + "</span></p>";
                $("#chat").append(mensajeHTML);
            });
        },
        error: function (jqXHR, textStatus, errorThrown) {
            console.log("Error al cargar mensajes: " + textStatus + " " + errorThrown);
            console.log(jqXHR.responseText);
        }
    });
}

function enviarMensaje() {
    var remitente = document.getElementById('usuario').value;
    var contenido = document.getElementById('contenido').value;
	console.log(remitente + ': ' + contenido);
	
    if (remitente && contenido) {
        var mensaje = { remitente: remitente, contenido: contenido };
        $.ajax({
            method: "POST",
            url: "/mensajes",
            data: JSON.stringify(mensaje),
            processData: false,
            contentType: "application/json",
            success: function () {
                cargarMensajes();
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.log("Error al enviar mensaje: " + textStatus + " " + errorThrown);
                console.log(jqXHR.responseText);
            }
        });
    }
}

	$(document).ready(function () {
    	cargarMensajes();
	});
  </script>

</body>
</html>